<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Gopherbot DevOps Chatbot</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="Title.html">Title</a></li><li class="expanded affix "><a href="Foreward.html">Foreward</a></li><li class="expanded affix "><a href="Introduction.html">Introduction</a></li><li class="expanded "><a href="Installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li><ol class="section"><li class="expanded "><a href="InstallOverview.html"><strong aria-hidden="true">1.1.</strong> Installation Overview</a></li><li class="expanded "><a href="DockerInstall.html"><strong aria-hidden="true">1.2.</strong> Docker Install</a></li></ol></li><li class="expanded "><a href="Modules.html"><strong aria-hidden="true">2.</strong> Module Support</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Gopherbot DevOps Chatbot</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#gopherbotbrdevops-chatbot" id="gopherbotbrdevops-chatbot">Gopherbot</br>DevOps Chatbot</a></h1>
By David Parsley, parsley@linuxjedi.org<p>My work with ChatOps began with Hubot around 2012 when I was working as an systems engineer for a small hosting provider. The owner had sent me a link to Hubot, asking me to have a look. I took to the concept immediately, and started automating all kinds of tasks that our support team could easily access from our team chat. Soon they were using our robot to troubleshoot email routing and DNS issues, migrate mailboxes, and build new cPanel server instances.</p>
<p>Not being a very talented (or motivated) Javascript/NodeJS programmer, my Hubot commands invariably followed the same pattern: write it in Javascript if it was <em>trivially</em> easy  to do so, otherwise shell out to bash and return the results. This was productive and gave results, but it was ugly and limited in functionality.</p>
<p>When I began teaching myself Go, I needed a good project to learn with. After my experience with Hubot, I decided to write a robot that was more approachable for Systems and DevOps engineers like myself - tasked with providing functionality most easily accessible from e.g. bash or python scripts. Towards that end, Gopherbot's design:</p>
<ul>
<li>Is CGI-like in operation: the compiled server process spawns scripts which can then use a simple API for interacting with the user / chat service</li>
<li>Supports any number of scripting languages by using a simple json-over-http localhost interface</li>
<li>Uses a multi-process design with method calls that block</li>
</ul>
<p>Ultimately, Gopherbot gives me a strong alternative to writing Yet Another Web Application to deliver some kind of reporting, security, or management functionality to managers and technical users. It's a good meet-in-the-middle solution that's nearly as easy to use as a web application, with some added benefits:</p>
<ul>
<li>The chat application gives you a single pane of glass for access to a wide range of functionality</li>
<li>The shared-view nature of channels gives an added measure of security thanks to visibility, and also a simple means of training users to interact with a given application</li>
<li>Like a CGI, applications can focus on functionality, with security and access control being configured in the server process</li>
</ul>
<p>It is my hope that this design will appeal to other engineers like myself, and that somewhere, somebody will exclaim &quot;Wait, what? I can write chat bot plugins <em><strong>in BASH</strong></em>?!?&quot;</p>
<p>David Parsley, March 2017 / September 2019</p>
<pre><code class="language-bash">#!/bin/bash

# echo.sh - trivial shell plugin example for Gopherbot

# START Boilerplate
[ -z &quot;$GOPHER_INSTALLDIR&quot; ] &amp;&amp; { echo &quot;GOPHER_INSTALLDIR not set&quot; &gt;&amp;2; exit 1; }
source $GOPHER_INSTALLDIR/lib/gopherbot_v1.sh

command=$1
shift
# END Boilerplate

configure(){
	cat &lt;&lt;&quot;EOF&quot;
---
Help:
- Keywords: [ &quot;repeat&quot; ]
  Helptext: [ &quot;(bot), repeat (me) - prompt for and trivially repeat a phrase&quot; ]
CommandMatchers:
- Command: &quot;repeat&quot;
  Regex: '(?i:repeat( me)?)'
EOF
}

case &quot;$command&quot; in
# NOTE: only &quot;configure&quot; should print anything to stdout
	&quot;configure&quot;)
		configure
		;;
	&quot;repeat&quot;)
		REPEAT=$(PromptForReply SimpleString &quot;What do you want me to repeat?&quot;)
		RETVAL=$?
		if [ $RETVAL -ne $GBRET_Ok ]
		then
			Reply &quot;Sorry, I had a problem getting your reply: $RETVAL&quot;
		else
			Reply &quot;$REPEAT&quot;
		fi
		;;
esac
</code></pre>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p><strong>Gopherbot</strong> DevOps Chatbot is a tool for teams of developers, operators, infrastructure engineers and support personnel - primarily for those that are already using Slack or another team chat platform for day-to-day communication. It belongs to and integrates well with a larger family of tools including <em>Ansible</em>, <em>git</em> and <em>ssh</em>, and is able to perform many tasks similar to <em>Jenkins</em> or <em>TravisCI</em>.</p>
<p>The primary strengths of <strong>Gopherbot</strong> stem from it's simplicity and flexibility. It installs and bootstraps readily on a VM or in a container with just a few environment variables, and can be run behind a firewall where it can perform tasks like rebooting server hardware over IPMI. Simple command plugins can be written in <code>bash</code> or <code>python</code>, with easy to use encrypted secrets for accomplishing privileged tasks.</p>
<p>The philosophy underlying <strong>Gopherbot</strong> is that it's more efficient to use a single, general-purpose tool to accomplish a wide variety of tasks reasonably well, rather than integrating and maintaining several specialized tools. It's true that <strong>Gopherbot</strong> doesn't do CI/CD as well as, say, <em>Jenkins</em> - but it's amazing how productive I am with it. Perhaps the best example of it's flexibility can be seen in the CI/CD pipeline for <strong>Gopherbot</strong> itself; start reading with <code>pipeline.sh</code> in <a href="https://github.com/lnxjedi/gopherbot/tree/master/.gopherci">the <code>.gopherci</code> directory</a>.</p>
<p>Version 2 for the most part assumes that your robot will employ encryption and get it's configuration from a <em>git</em> repository. Other deployments are possible, but not well documented. This manual will focus on working with <strong>Gopherbot</strong> instances whose configuration is stored on <a href="https://github.com">Github</a>, but other <em>git</em> services are easy to use, as well.</p>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<p>The most basic install of <strong>Gopherbot</strong> consists of extracting the archive to <code>/opt/gopherbot</code>, creating a robot configuration repository, and running the <code>gopherbot</code> binary from the root of that directory. There are a number of other details covered in the <a href="InstallOverview.html">overview</a>, but that's the gist of it.</p>
<h1><a class="header" href="#installation-overview" id="installation-overview">Installation Overview</a></h1>
<p>Version 2 of <strong>Gopherbot</strong> introduced a new, unified and simplified install method for both host- and container- based installs. Whether creating an instance of a new robot, or running an existing robot in a new location, basic installation to a host consists of a few simple steps:</p>
<ol>
<li>Un-zip or un-tar the download archive in <code>/opt/gopherbot</code></li>
<li>Create a new empty directory for your robot; by convention <code>\&lt;name\&gt;-gopherbot</code>, e.g. <code>clu-gopherbot</code>
<ol>
<li>Optionally, create a symlink to the binary, e.g.: <code>cd clu-gopherbot; ln -s /opt/gopherbot/gopherbot .</code></li>
</ol>
</li>
<li>Run the gopherbot binary from the new directory: <code>/opt/gopherbot/gopherbot</code> or <code>./gopherbot</code></li>
</ol>
<h2><a class="header" href="#quick-start-with-docker" id="quick-start-with-docker">Quick Start with Docker</a></h2>
<p>If you've already got a Docker host and Slack team, this is the absolute fastest way to get your very own robot up and running for playing around with, though not recommended for production installs.</p>
<ol>
<li>Get a Slack token for your robot at https://&lt;your-team&gt;.slack.com/services/new/bot</li>
<li>Create the environment file <code>.env</code>, filling in your specific values (except for GOPHER_ADMIN, filled in later):</li>
</ol>
<pre><code class="language-env">GOPHER_ADMIN=
GOPHER_SLACK_TOKEN=xoxb-yourTokenHere
GOPHER_BOTNAME=nameOfYourBot
GOPHER_BOTFULLNAME=&quot;Optional Full Name&quot;
# A one-character alias for addressing the robot, e.g. \ping
# Other good values: ; ! *
GOPHER_ALIAS=\
</code></pre>
<ol start="3">
<li>Start your robot with <code>docker run --env .env --name &lt;nameOfYourBot&gt; lnxjedi/gopherbot</code>, for example:</li>
</ol>
<pre><code class="language-shell">$ docker run --env-file .env --name frodo lnxjedi/gopherbot
</code></pre>
<p>If all goes well, your terminal window will start filling up with <strong>Gopherbot</strong> debug logs, and your robot will connect to your Slack team. Now you can invite your robot user to a channel and try out a few commands. Assuming you used <code>\</code> for the alias, and <code>frodo</code> for the robot's name, you can try:</p>
<ul>
<li><code>\ping</code></li>
<li><code>frodo, info</code></li>
<li><code>help</code> - for general help</li>
<li><code>\help</code> - for help on available commands</li>
<li><code>\whoami</code></li>
</ul>
<h3><a class="header" href="#adding-an-administrator" id="adding-an-administrator">Adding an Administrator</a></h3>
<p>These instructions assume you kept the default <code>\</code> for the robot's alias.</p>
<ol>
<li>Use the <code>\whoami</code> command to determine your actual Slack username, which frequently differs from the display name you see in channels</li>
<li>Press &lt;ctrl-c&gt; to stop your container, then remove it:</li>
</ol>
<pre><code class="language-shell">$ docker container rm frodo
</code></pre>
<ol start="3">
<li>Edit the <code>.env</code> file, adding your Slack user name for <code>GOPHER_ADMIN</code></li>
<li>Run the robot again as in step 3 above</li>
</ol>
<p>Now you can try out some more commands:</p>
<ul>
<li><code>\reload</code></li>
<li><code>\info</code> (more verbose output for admins)</li>
</ul>
<p>Additionally, there are a few commands you can try in a DM (private message) to the robot:</p>
<ul>
<li><code>list plugins</code></li>
<li><code>debug task memes</code></li>
<li><code>quit</code> - the container will exit and need to be re-started</li>
<li><code>help</code> - the list of commands will include all the administrator commands</li>
</ul>
<p>TODO: More documentation, including production installs.</p>
<h2><a class="header" href="#gopherbot-loadable-module-support" id="gopherbot-loadable-module-support">Gopherbot Loadable Module Support</a></h2>
<p><strong>Gopherbot's</strong> loadable module support now allows new or updated <strong>Go</strong> plugins to be loaded in to a running robot (though it requires a full restart).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
